<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <Target Name="UpdateOutPathToPluginsFolder"
            BeforeTargets="PrepareForBuild"
            Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU' And ('$(OutputPath)' == 'bin\$(Configuration)\$(TargetFramework)\' Or '$(OutputPath)' == 'bin\$(Configuration)\')">
        <PropertyGroup>
            <InvalidUUIDRegExPattern>[^A-z0-9\-\.]+</InvalidUUIDRegExPattern>
            <Author Condition="'$(Author)' == ''">user</Author>
            <Author>$([System.Text.RegularExpressions.Regex]::Replace('$(Author)', '$(InvalidUUIDRegExPattern)', '').ToLower())</Author>
            <Name Condition="'$(Name)' == ''">plugin</Name>
            <Name>$([System.Text.RegularExpressions.Regex]::Replace('$(Name)', '$(InvalidUUIDRegExPattern)', '').ToLower())</Name>
            <OutputPath>$(APPDATA)\Elgato\StreamDeck\Plugins\com.$(Author).$(Name).sdPlugin\</OutputPath>
            <OutDir>$(OutputPath)</OutDir>
            <TargetDir>$(OutputPath)</TargetDir>
            <ProjectDepsFilePath>$(OutputPath)$(ProjectDepsFileName)</ProjectDepsFilePath>
            <ProjectRuntimeConfigFilePath>$(OutputPath)$(ProjectRuntimeConfigFileName)</ProjectRuntimeConfigFilePath>
        </PropertyGroup>

        <Message Text="Installing plugin -> $(OutputPath)" Importance="high" />
    </Target>

    <Target Name="GeneratePluginManifest" AfterTargets="PostBuildEvent">
        <Copy SourceFiles="manifest.json" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true" />
    </Target>

    <Target Name="GeneratePluginManifestForPublish" AfterTargets="Publish">
        <Copy SourceFiles="manifest.json" DestinationFolder="$(PublishDir)" SkipUnchangedFiles="true" />
    </Target>

</Project>